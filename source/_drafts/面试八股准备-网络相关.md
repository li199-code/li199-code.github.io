---
title: 面试八股准备-网络相关
date: 2022-08-14 17:10:21
tags:
- interview
- http
---

从最简单的网络场景：家庭网络出发。这种网络下，有两种设备类型：终端和交换机（路由器）

终端：
一个可以上网的终端，有网卡，绑定了全球唯一的mac地址。当终端连入局域网，终端会通过dhcp协议向交换机请求分配一个ip地址。于是终端就有了在局域网内唯一的IP地址。

交换机：
有端口（对应路由器的lan）。一个端口就对应于一个终端的mac，里面维护了一张表，即mac地址和端口的映射表。交换机只关心数据包中的mac地址。

向同一子网下的其他终端发送数据时，需要知道对方的mac地址。ARP协议是发送方向子网内所有设备发送广播报文，询问接收方的mac地址，只要正确的接收方回复，其他终端都丢弃。发送方收到后，将报文补齐mac地址，通过交换机发送出去。同时，交换机会储存下完整的映射表，下次通信，交换机可以直接转发。

路由器：我们家用的路由器，如果去掉了lan口，就成了交换机。我们可以将所有wan口视为一个子网，而lan口连接的互联网（外网）视作另一个子网。显然，mac地址不能表示终端是否属于一个子网，所以，终端还要ip地址来表示。ip地址前一部分表示哪个子网，后一部分表示子网下的哪个终端。不同子网的通信，需要网关实现。网关有两个网卡，分别属于两个子网。若子网a中的终端要发送数据，先判断目标终端的ip地址是否在同一子网下，若是，则按交换机的方法直接发出；若不是，则由网关转发。这种根据目标ip判断如何发送的方式就称为路由。路由器维护了一张路由表

为什么两个家庭中ip地址同为192.168.1.5的终端能够通信？因为NAT技术。NAT改变了网关转发时源终端的ip地址，并在接受到数据时，转为源终端的ip地址。

### http缓存原理

控制http缓存的参数：cache-control/[Last-Modified / If-Modified-Since]/[Last-Modified / If-Modified-Since]

浏览器先判断请求的资源是否有缓存，再判断缓存是否过期。如果没过期，则直接从缓存中读取。若过期，则看是否有Etag字段，若有，则向服务器发送带有唯一标识的If-None-Match字段的请求；如果没有etag，就看是否有last-modified，若有，则向服务器发送带资源最后修改时间的If-Modified-Since字段的请求。若服务器对这两种请求的响应为304，则说明浏览器的缓存没过期；若返回200，则说明过期，重新请求。

### tcp三次握手和四次挥手

握手：1.客户端向服务器发送syn报文和初始号，2.服务器收到后回复syn+ack报文以及确认号，3.客户端收到后进入连接建立状态，并回复ack报文和确认号。服务器收到后也进入连接建立状态。

挥手：1.客户端发送fin报文和初始号，2.服务器收到后发送ack报文和确认号，并进入close-wait状态，此时，客户端不能向服务器请求数据，但服务器可以向浏览器输送未完成输送的数据，3.等数据全部传输完毕后，服务器再次向客户端发送fin报文，并进入last-ack状态，此时所有数据传输停止，4.客户端收到后，发送ack报文，进入time-wait状态，等2msl（最大段生存期，指报文段在网络中生存的时间，超时会被抛弃）后，进入关闭状态，服务器收到报文后，才会进入关闭状态。

### http状态码

2xx Success 请求正常处理完毕
3xx Redirection 需要进行附加操作来完成请求
4xx Client Error 服务器无法处理请求
5xx Server Error 服务器处理请求出错
